<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SDE Visualization - Interactive Diffusion Model Explorer</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>

<!-- Control Panel -->
<div class="control-panel">
    <!-- Trajectory Controls -->
    <div class="control-group">
        <label>Paths:</label>
        <input type="range" id="paths-slider" min="5" max="50" step="5" value="20">
        <span class="value-display" id="paths-value">20</span>
    </div>

    <div class="control-group">
        <label>Steps:</label>
        <input type="range" id="steps-slider" min="50" max="400" step="50" value="200">
        <span class="value-display" id="steps-value">200</span>
    </div>

    <!-- SDE Type -->
    <div class="control-group">
        <label>SDE Type:</label>
        <select id="sde-select">
            <option value="vp">VP-SDE</option>
            <option value="ve">VE-SDE</option>
            <option value="subvp">Sub-VP SDE</option>
        </select>
    </div>

    <!-- Initial Distribution -->
    <div class="control-group">
        <label>Initial Dist:</label>
        <select id="initial-dist-select">
            <option value="bimodal">Bimodal</option>
            <option value="uniform">Uniform</option>
            <option value="single">Single Gaussian</option>
        </select>
    </div>

    <!-- Color Scheme -->
    <div class="control-group">
        <label>Colors:</label>
        <select id="color-scheme-select">
            <option value="rainbow">Rainbow</option>
            <option value="viridis">Viridis</option>
            <option value="plasma">Plasma</option>
            <option value="monochrome">Monochrome</option>
        </select>
    </div>

    <!-- Background -->
    <div class="control-group">
        <label>Background:</label>
        <select id="background-select">
            <option value="white">White</option>
            <option value="dark">Dark</option>
            <option value="academic">Academic</option>
        </select>
    </div>

    <!-- Toggle Switches -->
    <div class="control-group">
        <label>Legend:</label>
        <div class="toggle-switch" id="legend-toggle"></div>
    </div>

    <div class="control-group">
        <label>ODE:</label>
        <div class="toggle-switch active" id="ode-toggle"></div>
    </div>

    <div class="control-group">
        <label>SDE:</label>
        <div class="toggle-switch active" id="sde-toggle"></div>
    </div>

    <div class="control-group">
        <label>Heatmap:</label>
        <div class="toggle-switch active" id="heatmap-toggle"></div>
    </div>

    <!-- Action Buttons -->
    <div class="control-group">
        <button id="regenerate-btn">Regenerate</button>
        <button id="reset-btn">Reset</button>
    </div>
</div>

<!-- Loading Indicator -->
<div class="loading-indicator" id="loading-indicator">
    Generating visualization...
</div>

<!-- Chart Container -->
<div id="chart-container"></div>

<!-- JavaScript Modules -->
<script src="js/config.js"></script>
<script src="js/math.js"></script>
<script src="js/simulation.js"></script>
<script src="js/visualization.js"></script>
<script src="js/controls.js"></script>

<!-- Main Application -->
<script>
    /**
     * Main Application Initialization
     */
    (function() {
        'use strict';
        
        // Initialize managers
        const configManager = new ConfigManager();
        const simulationGenerator = new SimulationGenerator(configManager);
        const visualizationManager = new VisualizationManager('chart-container', configManager);
        const controlsManager = new ControlsManager(configManager, simulationGenerator, visualizationManager);
        
        // Initial render
        console.log('Initializing SDE Visualization...');
        controlsManager.showLoading(true);
        
        setTimeout(() => {
            try {
                const initialData = simulationGenerator.generate();
                visualizationManager.render(initialData);
                console.log('Visualization initialized successfully!');
            } catch (error) {
                console.error('Initialization error:', error);
                alert('Failed to initialize visualization. Please refresh the page.');
            } finally {
                controlsManager.showLoading(false);
            }
        }, 100);
        
        // Make managers globally accessible for debugging
        window.app = {
            config: configManager,
            simulator: simulationGenerator,
            visualizer: visualizationManager,
            controls: controlsManager
        };
        
        console.log('App ready! Access via window.app');
    })();
</script>

</body>
</html>
